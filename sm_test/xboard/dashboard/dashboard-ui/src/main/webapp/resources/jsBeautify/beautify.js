(function(){function e(e,n){"use strict";var r=new t(e,n);return r.beautify()}function t(e,t){"use strict";function A(e,t){var n=0;if(e){n=e.indentation_level;n+=e.var_line&&e.var_line_reindented?1:0;if(!H()&&e.line_indent_level>n){n=e.line_indent_level}}var i={mode:t,parent:e,last_text:e?e.last_text:"",last_word:e?e.last_word:"",var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,multiline_frame:false,if_block:false,do_block:false,do_while:false,in_case_statement:false,in_case:false,case_body:false,indentation_level:n,line_indent_level:e?e.line_indent_level:n,start_line_index:r.length,ternary_depth:0};return i}function O(){return{text:[]}}function M(e){e=e===undefined?false:e;if(r.length){_(r[r.length-1],e);while(e&&r.length>1&&r[r.length-1].text.length===0){r.pop();_(r[r.length-1],e)}}}function _(e){while(e.text.length&&(e.text[e.text.length-1]===" "||e.text[e.text.length-1]===a||e.text[e.text.length-1]===L)){e.text.pop()}}function D(e){return e.replace(/^\s+|\s+$/g,"")}function P(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1){t.push(e.substring(0,n));e=e.substring(n+1);n=e.indexOf("\n")}if(e.length){t.push(e)}return t}function H(){var e=r[r.length-1];return e.text.length===0}function B(){if(H()){if(r.length===1){return true}var e=r[r.length-2];return e.text.length===0}return false}function j(e){e=e===undefined?false:e;if(k.wrap_line_length&&!e){var t=r[r.length-1];var n=0;if(t.text.length>0){n=t.text.join("").length+i.length+(E?1:0);if(n>=k.wrap_line_length){e=true}}}if((k.preserve_newlines&&b||e)&&!H()){F(false,true);if(!($(f.mode)||J(f.mode))){w=true}}}function F(e,t){w=false;E=false;if(!t){if(f.last_text!==";"){while(f.mode===C.Statement&&!f.if_block&&!f.do_block){K()}}}if(r.length===1&&H()){return}if(e||!H()){f.multiline_frame=true;r.push(O())}}function I(){if(H()){var e=r[r.length-1];if(k.keep_array_indentation&&$(f.mode)&&b){e.text.push("");for(var t=0;t<T.length;t+=1){e.text.push(T[t])}}else{if(L){e.text.push(L)}q(f.indentation_level+(f.var_line&&f.var_line_reindented?1:0)+(w?1:0))}}}function q(e){if(r.length>1){var t=r[r.length-1];f.line_indent_level=e;for(var n=0;n<e;n+=1){t.text.push(a)}}}function R(){var e=r[r.length-1];if(E&&e.text.length){var t=e.text[e.text.length-1];if(t!==" "&&t!==a){e.text.push(" ")}}}function U(e){e=e||i;I();w=false;R();E=false;r[r.length-1].text.push(e)}function z(){f.indentation_level+=1}function W(){if(f.indentation_level>0&&(!f.parent||f.indentation_level>f.parent.indentation_level))f.indentation_level-=1}function X(e){if(e.multiline_frame)return;var t=e.start_line_index;var n=0;var i;while(t<r.length){i=r[t];t++;if(i.text.length===0){continue}if(L&&i.text[0]===L){n=1}else{n=0}if(i.text[n]===a){i.text.splice(n,1)}}}function V(e){if(f){c.push(f);l=f}else{l=A(null,e)}f=A(l,e)}function $(e){return e===C.ArrayLiteral}function J(e){return Z(e,[C.Expression,C.ForInitializer,C.Conditional])}function K(){if(c.length>0){l=f;f=c.pop()}}function Q(){if(f.last_text==="do"||f.last_text==="else"&&i!=="if"||o==="TK_END_EXPR"&&(l.mode===C.ForInitializer||l.mode===C.Conditional)){j(Z(i,["do","for","if","while"]));V(C.Statement);if(H()){z();w=false}return true}return false}function G(e,t){for(var n=0;n<e.length;n++){var r=D(e[n]);if(r.charAt(0)!==t){return false}}return true}function Y(e){return Z(e,["case","return","do","if","throw","else"])}function Z(e,t){for(var n=0;n<t.length;n+=1){if(t[n]===e){return true}}return false}function et(e){var t=false,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r);r++;if(t){t=false;if(o==="x"){i=e.substr(r,2);r+=2}else if(o==="u"){i=e.substr(r,4);r+=4}else{n+="\\"+o;continue}if(!i.match(/^[0123456789abcdefABCDEF]+$/)){return e}s=parseInt(i,16);if(s>=0&&s<32){if(o==="x"){n+="\\x"+i}else{n+="\\u"+i}continue}else if(s===34||s===39||s===92){n+="\\"+String.fromCharCode(s)}else if(o==="x"&&s>126&&s<=255){return e}else{n+=String.fromCharCode(s)}}else if(o==="\\"){t=true}else{n+=o}}return n}function tt(e){var t=v;var r=n.charAt(t);while(Z(r,h)&&r!==e){t++;if(t>=S){return false}r=n.charAt(t)}return r===e}function nt(){var e,t;x=0;if(v>=S){return["","TK_EOF"]}b=false;T=[];var i=n.charAt(v);v+=1;while(Z(i,h)){if(i==="\n"){x+=1;T=[]}else if(x){if(i===a){T.push(a)}else if(i!=="\r"){T.push(" ")}}if(v>=S){return["","TK_EOF"]}i=n.charAt(v);v+=1}if(Z(i,p)){if(v<S){while(Z(n.charAt(v),p)){i+=n.charAt(v);v+=1;if(v===S){break}}}if(v!==S&&i.match(/^[0-9]+[Ee]$/)&&(n.charAt(v)==="-"||n.charAt(v)==="+")){var s=n.charAt(v);v+=1;var u=nt();i+=s+u[0];return[i,"TK_WORD"]}if(i==="in"){return[i,"TK_OPERATOR"]}return[i,"TK_WORD"]}if(i==="("||i==="["){return[i,"TK_START_EXPR"]}if(i===")"||i==="]"){return[i,"TK_END_EXPR"]}if(i==="{"){return[i,"TK_START_BLOCK"]}if(i==="}"){return[i,"TK_END_BLOCK"]}if(i===";"){return[i,"TK_SEMICOLON"]}if(i==="/"){var c="";var m=true;if(n.charAt(v)==="*"){v+=1;if(v<S){while(v<S&&!(n.charAt(v)==="*"&&n.charAt(v+1)&&n.charAt(v+1)==="/")){i=n.charAt(v);c+=i;if(i==="\n"||i==="\r"){m=false}v+=1;if(v>=S){break}}}v+=2;if(m&&x===0){return["/*"+c+"*/","TK_INLINE_COMMENT"]}else{return["/*"+c+"*/","TK_BLOCK_COMMENT"]}}if(n.charAt(v)==="/"){c=i;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){c+=n.charAt(v);v+=1;if(v>=S){break}}return[c,"TK_COMMENT"]}}if(i==="'"||i==='"'||(i==="/"||k.e4x&&i==="<"&&n.slice(v-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&(o==="TK_WORD"&&Y(f.last_text)||o==="TK_END_EXPR"&&Z(l.mode,[C.Conditional,C.ForInitializer])||Z(o,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var y=i,w=false,E=false;t=i;if(v<S){if(y==="/"){var N=false;while(w||N||n.charAt(v)!==y){t+=n.charAt(v);if(!w){w=n.charAt(v)==="\\";if(n.charAt(v)==="["){N=true}else if(n.charAt(v)==="]"){N=false}}else{w=false}v+=1;if(v>=S){return[t,"TK_STRING"]}}}else if(k.e4x&&y==="<"){var L=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g;var A=n.slice(v-1);var O=L.exec(A);if(O&&O.index===0){var M=O[2];var _=0;while(O){var P=!!O[1];var H=O[2];var B=!!O[O.length-1]||H.slice(0,8)==="![CDATA[";if(H===M&&!B){if(P){--_}else{++_}}if(_<=0){break}O=L.exec(A)}var j=O?O.index+O[0].length:A.length;v+=j-1;return[A.slice(0,j),"TK_STRING"]}}else{while(w||n.charAt(v)!==y){t+=n.charAt(v);if(w){if(n.charAt(v)==="x"||n.charAt(v)==="u"){E=true}w=false}else{w=n.charAt(v)==="\\"}v+=1;if(v>=S){return[t,"TK_STRING"]}}}}v+=1;t+=y;if(E&&k.unescape_strings){t=et(t)}if(y==="/"){while(v<S&&Z(n.charAt(v),p)){t+=n.charAt(v);v+=1}}return[t,"TK_STRING"]}if(i==="#"){if(r.length===1&&r[0].text.length===0&&n.charAt(v)==="!"){t=i;while(v<S&&i!=="\n"){i=n.charAt(v);t+=i;v+=1}return[D(t)+"\n","TK_UNKNOWN"]}var F="#";if(v<S&&Z(n.charAt(v),g)){do{i=n.charAt(v);F+=i;v+=1}while(v<S&&i!=="#"&&i!=="=");if(i==="#"){}else if(n.charAt(v)==="["&&n.charAt(v+1)==="]"){F+="[]";v+=2}else if(n.charAt(v)==="{"&&n.charAt(v+1)==="}"){F+="{}";v+=2}return[F,"TK_WORD"]}}if(i==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3;i="<!--";while(n.charAt(v)!=="\n"&&v<S){i+=n.charAt(v);v++}f.in_html_comment=true;return[i,"TK_COMMENT"]}if(i==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->"){f.in_html_comment=false;v+=2;return["-->","TK_COMMENT"]}if(i==="."){return[i,"TK_DOT"]}if(Z(i,d)){while(v<S&&Z(i+n.charAt(v),d)){i+=n.charAt(v);v+=1;if(v>=S){break}}if(i===","){return[i,"TK_COMMA"]}else if(i==="="){return[i,"TK_EQUALS"]}else{return[i,"TK_OPERATOR"]}}return[i,"TK_UNKNOWN"]}function rt(){if(Q()){}var e=C.Expression;if(i==="["){if(o==="TK_WORD"||f.last_text===")"){if(Z(f.last_text,m)){E=true}V(e);U();z();if(k.space_in_paren){E=true}return}e=C.ArrayLiteral;if($(f.mode)){if(f.last_text==="["||f.last_text===","&&(u==="]"||u==="}")){if(!k.keep_array_indentation){F()}}}}else{if(f.last_text==="for"){e=C.ForInitializer}else if(Z(f.last_text,["if","while"])){e=C.Conditional}else{}}if(f.last_text===";"||o==="TK_START_BLOCK"){F()}else if(o==="TK_END_EXPR"||o==="TK_START_EXPR"||o==="TK_END_BLOCK"||f.last_text==="."){j(b);w=false}else if(o!=="TK_WORD"&&o!=="TK_OPERATOR"){E=true}else if(f.last_word==="function"||f.last_word==="typeof"){if(k.jslint_happy){E=true}}else if(Z(f.last_text,m)||f.last_text==="catch"){if(k.space_before_conditional){E=true}}if(i==="("){if(o==="TK_EQUALS"||o==="TK_OPERATOR"){if(f.mode!==C.ObjectLiteral){j()}}}V(e);U();if(k.space_in_paren){E=true}z()}function it(){while(f.mode===C.Statement){K()}if(i==="]"&&$(f.mode)&&f.multiline_frame&&!k.keep_array_indentation){F()}if(f.multiline_frame){j()}if(k.space_in_paren){E=true}if(i==="]"&&k.keep_array_indentation){U();K()}else{K();U()}X(l);if(f.do_while&&l.mode===C.Conditional){l.mode=C.Expression;f.do_block=false;f.do_while=false}}function st(){V(C.BlockStatement);var e=tt("}");var t=e&&f.last_word==="function"&&o==="TK_END_EXPR";if(k.brace_style==="expand"){if(o!=="TK_OPERATOR"&&(t||o==="TK_EQUALS"||Y(f.last_text)&&f.last_text!=="else")){E=true}else{F()}}else{if(o!=="TK_OPERATOR"&&o!=="TK_START_EXPR"){if(o==="TK_START_BLOCK"){F()}else{E=true}}else{if($(l.mode)&&f.last_text===","){if(u==="}"){E=true}else{F()}}}}U();z()}function ot(){while(f.mode===C.Statement){K()}var e=o==="TK_START_BLOCK";if(k.brace_style==="expand"){if(!e){F()}}else{if(!e){if($(f.mode)&&k.keep_array_indentation){k.keep_array_indentation=false;F();k.keep_array_indentation=true}else{F()}}}K();U()}function ut(){if(Q()){}else if(b&&!J(f.mode)&&(o!=="TK_OPERATOR"||f.last_text==="--"||f.last_text==="++")&&o!=="TK_EQUALS"&&(k.preserve_newlines||f.last_text!=="var")){F()}if(f.do_block&&!f.do_while){if(i==="while"){E=true;U();E=true;f.do_while=true;return}else{F();f.do_block=false}}if(f.if_block){if(i!=="else"){while(f.mode===C.Statement){K()}f.if_block=false}}if(i==="case"||i==="default"&&f.in_case_statement){F();if(f.case_body||k.jslint_happy){W();f.case_body=false}U();f.in_case=true;f.in_case_statement=true;return}if(i==="function"){if(f.var_line&&o!=="TK_EQUALS"){f.var_line_reindented=true}if((H()||f.last_text===";"||f.last_text==="}")&&f.last_text!=="{"&&!$(f.mode)){if(!B()){F();F(true)}}if(o==="TK_WORD"){if(f.last_text==="get"||f.last_text==="set"||f.last_text==="new"||f.last_text==="return"){E=true}else{F()}}else if(o==="TK_OPERATOR"||f.last_text==="="){E=true}else if(J(f.mode)){}else{F()}}if(o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR"){if(f.mode!==C.ObjectLiteral){j()}}if(i==="function"){U();f.last_word=i;return}y="NONE";if(o==="TK_END_BLOCK"){if(!Z(i,["else","catch","finally"])){y="NEWLINE"}else{if(k.brace_style==="expand"||k.brace_style==="end-expand"){y="NEWLINE"}else{y="SPACE";E=true}}}else if(o==="TK_SEMICOLON"&&f.mode===C.BlockStatement){y="NEWLINE"}else if(o==="TK_SEMICOLON"&&J(f.mode)){y="SPACE"}else if(o==="TK_STRING"){y="NEWLINE"}else if(o==="TK_WORD"){y="SPACE"}else if(o==="TK_START_BLOCK"){y="NEWLINE"}else if(o==="TK_END_EXPR"){E=true;y="NEWLINE"}if(Z(i,m)&&f.last_text!==")"){if(f.last_text==="else"){y="SPACE"}else{y="NEWLINE"}}if(Z(i,["else","catch","finally"])){if(o!=="TK_END_BLOCK"||k.brace_style==="expand"||k.brace_style==="end-expand"){F()}else{M(true);var e=r[r.length-1];if(e.text[e.text.length-1]!=="}"){F()}E=true}}else if(y==="NEWLINE"){if(Y(f.last_text)){E=true}else if(o!=="TK_END_EXPR"){if((o!=="TK_START_EXPR"||i!=="var")&&f.last_text!==":"){if(i==="if"&&f.last_word==="else"&&f.last_text!=="{"){E=true}else{f.var_line=false;f.var_line_reindented=false;F()}}}else if(Z(i,m)&&f.last_text!==")"){f.var_line=false;f.var_line_reindented=false;F()}}else if($(f.mode)&&f.last_text===","&&u==="}"){F()}else if(y==="SPACE"){E=true}U();f.last_word=i;if(i==="var"){f.var_line=true;f.var_line_reindented=false;f.var_line_tainted=false}if(i==="do"){f.do_block=true}if(i==="if"){f.if_block=true}}function at(){if(Q()){E=false}while(f.mode===C.Statement&&!f.if_block&&!f.do_block){K()}U();f.var_line=false;f.var_line_reindented=false;if(f.mode===C.ObjectLiteral){f.mode=C.BlockStatement}}function ft(){if(Q()){E=true}else if(o==="TK_WORD"){E=true}else if(o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR"){if(f.mode!==C.ObjectLiteral){j()}}else{F()}U()}function lt(){if(f.var_line){f.var_line_tainted=true}E=true;U();E=true}function ct(){if(f.var_line){if(J(f.mode)||o==="TK_END_BLOCK"){f.var_line_tainted=false}if(f.var_line){f.var_line_reindented=true}U();if(f.var_line_tainted){f.var_line_tainted=false;F()}else{E=true}return}if(o==="TK_END_BLOCK"&&f.mode!==C.Expression){U();if(f.mode===C.ObjectLiteral&&f.last_text==="}"){F()}else{E=true}}else{if(f.mode===C.ObjectLiteral){U();F()}else{U();E=true}}}function ht(){var e=true;var t=true;if(Y(f.last_text)){E=true;U();return}if(i==="*"&&o==="TK_DOT"&&!u.match(/^\d+$/)){U();return}if(i===":"&&f.in_case){f.case_body=true;z();U();F();f.in_case=false;return}if(i==="::"){U();return}if(b&&(i==="--"||i==="++")){F()}if(Z(i,["--","++","!"])||Z(i,["-","+"])&&(Z(o,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||Z(f.last_text,m)||f.last_text===",")){e=false;t=false;if(f.last_text===";"&&J(f.mode)){e=true}if(o==="TK_WORD"&&Z(f.last_text,m)){e=true}if((f.mode===C.BlockStatement||f.mode===C.Statement)&&(f.last_text==="{"||f.last_text===";")){F()}}else if(i===":"){if(f.ternary_depth===0){if(f.mode===C.BlockStatement){f.mode=C.ObjectLiteral}e=false}else{f.ternary_depth-=1}}else if(i==="?"){f.ternary_depth+=1}E=E||e;U();E=t}function pt(){var e=P(i);var t;var n=false;F(false,true);if(e.length>1){if(G(e.slice(1),"*")){n=true}}U(e[0]);for(t=1;t<e.length;t++){F(false,true);if(n){U(" "+D(e[t]))}else{r[r.length-1].text.push(e[t])}}F(false,true)}function dt(){E=true;U();E=true}function vt(){if(b){F(false,true)}else{M(true)}E=true;U();F(false,true)}function mt(){if(Y(f.last_text)){E=true}else{j(f.last_text===")"&&k.break_chained_methods)}U()}function gt(){U();if(i[i.length-1]==="\n"){F()}}var n,r;var i,s,o,u,a;var f,l,c;var h,p,d,v,m,g;var y;var b;var w,E;var S,x,T;var N,C,k;var L="";h="\n\r	 ".split("");p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");g="0123456789".split("");d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";d+=" <%= <% %> <?= <? ?>";d=d.split(" ");m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");C={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"};N={TK_START_EXPR:rt,TK_END_EXPR:it,TK_START_BLOCK:st,TK_END_BLOCK:ot,TK_WORD:ut,TK_SEMICOLON:at,TK_STRING:ft,TK_EQUALS:lt,TK_OPERATOR:ht,TK_COMMA:ct,TK_BLOCK_COMMENT:pt,TK_INLINE_COMMENT:dt,TK_COMMENT:vt,TK_DOT:mt,TK_UNKNOWN:gt};t=t?t:{};k={};if(t.space_after_anon_function!==undefined&&t.jslint_happy===undefined){t.jslint_happy=t.space_after_anon_function}if(t.braces_on_own_line!==undefined){k.brace_style=t.braces_on_own_line?"expand":"collapse"}k.brace_style=t.brace_style?t.brace_style:k.brace_style?k.brace_style:"collapse";if(k.brace_style==="expand-strict"){k.brace_style="expand"}k.indent_size=t.indent_size?parseInt(t.indent_size,10):4;k.indent_char=t.indent_char?t.indent_char:" ";k.preserve_newlines=t.preserve_newlines===undefined?true:t.preserve_newlines;k.break_chained_methods=t.break_chained_methods===undefined?false:t.break_chained_methods;k.max_preserve_newlines=t.max_preserve_newlines===undefined?0:parseInt(t.max_preserve_newlines,10);k.space_in_paren=t.space_in_paren===undefined?false:t.space_in_paren;k.jslint_happy=t.jslint_happy===undefined?false:t.jslint_happy;k.keep_array_indentation=t.keep_array_indentation===undefined?false:t.keep_array_indentation;k.space_before_conditional=t.space_before_conditional===undefined?true:t.space_before_conditional;k.unescape_strings=t.unescape_strings===undefined?false:t.unescape_strings;k.wrap_line_length=t.wrap_line_length===undefined?0:parseInt(t.wrap_line_length,10);k.e4x=t.e4x===undefined?false:t.e4x;a="";while(k.indent_size>0){a+=k.indent_char;k.indent_size-=1}while(e&&(e.charAt(0)===" "||e.charAt(0)==="	")){L+=e.charAt(0);e=e.substring(1)}n=e;S=e.length;o="TK_START_BLOCK";u="";r=[O()];w=false;E=false;T=[];c=[];V(C.BlockStatement);v=0;this.beautify=function(){var e,t,n,a;while(true){e=nt();i=e[0];s=e[1];if(s==="TK_EOF"){break}n=k.keep_array_indentation&&$(f.mode);b=x>0;if(n){for(t=0;t<x;t+=1){F(t>0)}}else{if(k.max_preserve_newlines&&x>k.max_preserve_newlines){x=k.max_preserve_newlines}if(k.preserve_newlines){if(x>1){F();for(t=1;t<x;t+=1){F(true)}}}}N[s]();if(s!=="TK_INLINE_COMMENT"&&s!=="TK_COMMENT"&&s!=="TK_UNKNOWN"){u=f.last_text;o=s;f.last_text=i}}a=r[0].text.join("");for(var l=1;l<r.length;l++){a+="\n"+r[l].text.join("")}a=a.replace(/[\r\n ]+$/,"");return a}}if(typeof define==="function"){if(typeof define.amd==="undefined"){define(function(t,n,r){n.js_beautify=e})}else{define([],function(){return e})}}else if(typeof exports!=="undefined"){exports.js_beautify=e}else if(typeof window!=="undefined"){window.js_beautify=e}else if(typeof global!=="undefined"){global.js_beautify=e}})()